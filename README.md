# STB-DiffChecker
二つのST-Bridgeファイル(stbファイル)を、重要度による優先順位をつけて比較するツール   
* 使用例
    * 設計の進捗に合わせて、解析モデルやBIMモデルからstbファイルを出力して変更箇所を確認する
    * 解析ファイルから出力したstbファイルとBIMから出力したstbファイルを比較して、整合性を確認する
    * 施工モデルからstbファイルを出力し、確認申請時のモデルと軽微変更申請時のモデルを比較する

## 重要度
以下の2点を考慮する必要があるため、これらを「重要度」として定義し、ST-Bridgeの要素・属性に設定できるようにしている  
* 各ステージ(注1)で確定されている情報とそうでない情報が混在している場合がある  
* 二つのファイルが持つ情報量が異なる場合がある（例：解析モデルとBIMモデルから出力したstbファイル）  
  
重要度を用いることで、比較結果を見やすく分類することができる  
* 重要度は"STB-DiffChecker"を使用するステージ毎に下記のように設定する
    * 高：確定すべき情報で、二つのファイルがともに出力可能な情報
    * 中：確定すべき情報だが、片方のファイルしかもっていない情報
    * 低：確定していない情報
    * 対象なし：ST-Bridgeで要素を特定するためのid属性など。"STB-DiffChecker"ではidによる比較をしていないので、同値である必要がない  
  
* 例)　S4(実施設計2)で解析モデルから出力したstbファイルとBIMから出力したstbファイルを比較した場合
    * 高：S4で確定すべき情報（部材符号、鉄筋本数など）  
    * 中：S4で確定すべきだが解析情報でもたない情報（幅止め筋など）  
    * 低：S4で確定していない情報（ふかし厚さなど）  
  
注1) [建築分野におけるBIMの標準ワークフローとその活用方策に関するガイドライン（第１版）別添参考資料](https://www.mlit.go.jp/jutakukentiku/content/001351966.pdf)  

## イメージ
"STB-DiffChecker"では以下のような結果出力が可能
![STB-DiffCheckerImage](https://github.com/NS-NS/STB-DiffChecker/blob/master/image/STB-DiffCheckerImage.gif)
 
## ST-Bridgeとは 
[buildingSMART Japan 構造設計小委員会](https://www.building-smart.or.jp/meeting/buildall/structural-design/)より引用
> ST-Bridgeとは・・・日本国内の建築構造分野での情報交換のための標準フォーマット  
> + 利用範囲を明確にすることによって、IFCよりシンプルで扱い易い  
> + 日本独自の表現方法を取り込む（通り芯、部材配置と断面符号、配筋情報）  
> + 国内の構造系アプリ、躯体積算アプリ、3次元オブジェクトCADとの連携を目指す   
 
 
## 特徴
* 2つのstbファイルを重要度や許容差をもうけて比較することができる
* 許容差は「基準点」と「基準点からのオフセット」について設定できる  
* 比較結果はフィルタリングでき、相違点を素早くチェックできる  
* 比較結果に対してコメント書き込みでき、Excelに出力できる  

## 要件
"STB-DiffChecker"の実行には以下のライブラリが必要
* NPOI(2.4.1)
* PDFsharp-MigraDoc-gdi(1.50.5147)
 
## 使用方法 
1. "STB-DiffChecker"を起動し、「入力・設定」タブ上で比較したいstbファイルをそれぞれ選択する
2. 「許容差」と「重要度」の設定ファイルを読み込む
3. (必要に応じて)許容差を修正する
4. 「実行」を押す 
5. 結果出力用のタブが作成されるので選択する
6. フィルタを設定して必要な情報を確認する
7. (必要に応じて）Excelに出力して確認する

## 備考 
* ST-Bridgeのバージョンは2.0.1を対象とする
* 比較
    * StbNode：節点座標で比較する
    * StbMember：許容差を考慮した部材節点座標で比較する
    * StbSection：部材符号と階によって比較する(idおよびguidで紐づけない)
* 比較結果は「一致」、「許容差内」、「不一致」、「比較対象なし」に分類する
* 比較結果の定義
    * 一致：完全一致
    * 許容差内：完全一致はしないが、許容差設定で指定した数値以内
    * 不一致：上記に該当しないもの
    * 比較対象なし：どちらかのファイルに比較対象の要素・属性がない
* StbCommonApplyに記入されている属性はすべて展開してから比較する
* 柱や梁は始点と終点を入れ替えて比較はしない
* 壁やスラブは節点座標順序を回転して比較はしない
* 梁や柱で複数断面が同一断面を有していても、一断面にまとめて比較はしない

## 注意
* stbファイルの出力元のソフトウェアにより出力項目が違うため、２つのソフトの出力項目に合わせて設定ファイルを作成する必要がある
* 解析ソフトとBIMソフトから出力するStbStoryの名称を統一する(FLの有無が問題になることが多いため)
  * よくある例(解析ソフト側:1　BIMソフト側:1FL)

## 作者 
* Y-Sakai
* HidekiTakei

## ライセンス
"STB-DiffChecker" is under [MIT license](https://en.wikipedia.org/wiki/MIT_License).
